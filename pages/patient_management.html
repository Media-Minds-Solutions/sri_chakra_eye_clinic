<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Patient Record System</title>
  <style>
    /* Your existing CSS (unchanged) */
    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: #f5f7fa;
      margin: 0; padding: 0;
      color: #333;
    }
    header {
      background: #1e40af;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      padding: 30px;
      max-width: 1200px;
      margin: auto;
    }
    .card {
      flex: 1;
      min-width: 300px;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: transform 0.2s;
    }
    .card:hover { transform: translateY(-3px); }
    h2 { color: #1e40af; font-size: 1.3rem; margin-bottom: 15px; }
    input, textarea, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }
    input:focus, textarea:focus {
      border-color: #1e40af;
      outline: none;
      box-shadow: 0 0 6px rgba(30,136,229,0.3);
    }
    button {
      background: #1e40af;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border: none;
      transition: background 0.3s;
    }
    button:hover { background: #1e40af; }
    .spinner {
      display: none;
      margin: 20px auto;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #1e40af;
      border-radius: 50%;
      width: 40px; height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 
      0% { transform: rotate(0deg); } 
      100% { transform: rotate(360deg); } 
    }
    .summary-card {
      background: #e3f2fd;
      border-left: 5px solid #1e40af;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    .summary-title {
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 8px;
    }
    .summary-detail { margin: 5px 0; }
    .summary-condition { color: #d32f2f; font-weight: bold; }
    .summary-prescription { color: #2e7d32; font-style: italic; }
    .timeline {
      margin-top: 20px;
      border-left: 3px solid #1e40af;
      padding-left: 20px;
    }
    .timeline-item {
      position: relative;
      margin-bottom: 20px;
      padding-left: 10px;
    }
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -28px;
      top: 5px;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: #1e40af;
      box-shadow: 0 0 0 4px #e3f2fd;
    }
    .timeline-card {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .timeline-date {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 5px;
    }
    .timeline-condition { font-weight: bold; color: #d32f2f; }
    .timeline-prescription { margin-top: 5px; font-style: italic; color: #2e7d32; }
    footer {
      background: #1e40af;
      color: white;
      padding: 40px 20px;
      margin-top: 40px;
    }
    footer .footer-container {
      max-width: 1200px;
      margin: auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 30px;
    }
    footer img {
      max-width: 60px;
      height: auto;
      margin-right: 12px;
    }
    footer h3, footer h4 { font-size: 1.1rem; margin-bottom: 10px; font-weight: bold; }
    footer p, footer a {
      color: #cbd5e1;
      font-size: 0.9rem;
      line-height: 1.5;
      text-decoration: none;
    }
    footer a:hover { color: white; }
    footer .footer-bottom {
      border-top: 1px solid rgba(255,255,255,0.2);
      margin-top: 30px;
      padding-top: 15px;
      text-align: center;
      font-size: 0.85rem;
      color: #cbd5e1;
    }
    .footer-contact svg {
      width: 20px; height: 20px; fill: #f59e0b; margin-right: 8px; flex-shrink: 0;
    }
    .footer-contact a, .footer-contact p {
      color: #bfdbfe; font-size: 0.9rem; line-height: 1.4;
    }
    .footer-contact a:hover { color: #fff; }
  </style>
</head>
<body>
<header style="display:flex;align-items:center;justify-content:space-between;padding:10px 20px;background:#1e40af;color:white;">
  <div style="display:flex;align-items:center;">
    <img src="images/Sri_Chakra_Logo.png" alt="Sri Chakra Logo" style="height:50px;width:auto;object-fit:contain;">
    <div style="margin-left:10px;">
      <h1 style="margin:0;font-size:1.2rem;font-weight:bold;">Sri Chakra</h1>
      <p style="margin:0;font-size:0.9rem;opacity:0.9;">Eye Clinic</p>
    </div>
  </div>
  <div style="flex-grow:1;text-align:center;font-size:1.8rem;font-weight:600;">
    Sri Chakra Patient Record System
  </div>
</header>

<div class="container">
  <!-- Patient Entry -->
  <div class="card">
    <h2>Add Patient</h2>
    <form id="patientForm">
      <input type="text" id="mobile" placeholder="Mobile Number" required>
      <input type="text" id="name" placeholder="Patient Name" required>
      <input type="number" id="age" placeholder="Age" required>
      <textarea id="condition" placeholder="Condition"></textarea>
      <textarea id="prescription" placeholder="Prescription"></textarea>
      <button type="submit">Add Patient</button>
    </form>
  </div>

  <!-- Search Patient -->
  <div class="card">
    <h2>Search Patient</h2>
    <input type="text" id="searchMobile" placeholder="Enter Mobile Number">
    <button onclick="searchPatient()">Search</button>
    <div class="spinner" id="loadingSpinner"></div>
    <div id="summary"></div>

    <!-- NEW Add Visit Section -->
    <div id="addVisitSection" style="display:none;margin-top:20px;">
      <h3 style="color:#1e40af;font-size:1.1rem;">âž• Add Visit</h3>
      <textarea id="newCondition" placeholder="New Condition"></textarea>
      <textarea id="newPrescription" placeholder="New Prescription"></textarea>
      <button onclick="addVisit()">Add Visit</button>
    </div>

    <div class="timeline" id="timeline"></div>
  </div>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbx9uK0WyfEKKPSM3C9giNMqXGjz6uoJz-0w4o06WVu-Nf4dTifdXyu5uFwUSZtbocGu/exec";
  let currentPatient = null;

  // Add patient
  document.getElementById("patientForm").addEventListener("submit", function(e) {
    e.preventDefault();
    let data = {
      mobile: document.getElementById("mobile").value,
      name: document.getElementById("name").value,
      age: document.getElementById("age").value,
      condition: document.getElementById("condition").value,
      prescription: document.getElementById("prescription").value,
    };
    document.getElementById("loadingSpinner").style.display = "block";
    fetch(API_URL, { method: "POST", body: JSON.stringify(data) })
      .then(res => res.text())
      .then(() => {
        alert("Patient Added!");
        document.getElementById("patientForm").reset();
        document.getElementById("loadingSpinner").style.display = "none";
      });
  });

  // Search patient
  function searchPatient() {
    let mobile = document.getElementById("searchMobile").value;
    document.getElementById("loadingSpinner").style.display = "block";
    fetch(`${API_URL}?action=search&mobile=${mobile}`)
      .then(res => res.json())
      .then(data => {
        let summaryDiv = document.getElementById("summary");
        let timeline = document.getElementById("timeline");
        summaryDiv.innerHTML = "";
        timeline.innerHTML = "";

        if (data.length === 0) {
          summaryDiv.innerHTML = "<p>No patient found.</p>";
          document.getElementById("addVisitSection").style.display = "none";
          document.getElementById("loadingSpinner").style.display = "none";
          return;
        }

        currentPatient = { mobile: data[0][0], name: data[0][1], age: data[0][2] };

        let latest = data[data.length - 1];
        summaryDiv.innerHTML = `
          <div class="summary-card">
            <div class="summary-title">${latest[1]} (Age ${latest[2]})</div>
            <div class="summary-detail">Mobile: ${latest[0]}</div>
            <div class="summary-detail">Total Visits: ${data.length}</div>
            <div class="summary-detail">Latest Visit: ${latest[5]}</div>
            <div class="summary-condition">Condition: ${latest[3]}</div>
            <div class="summary-prescription">Prescription: ${latest[4]}</div>
          </div>
        `;

        // show add visit form
        document.getElementById("addVisitSection").style.display = "block";

        data.forEach(row => {
          let item = document.createElement("div");
          item.className = "timeline-item";
          item.innerHTML = `
            <div class="timeline-card">
              <div class="timeline-date">Date: ${row[5]}</div>
              <div><strong>${row[1]}</strong>, Age ${row[2]} (${row[0]})</div>
              <div class="timeline-condition">Condition: ${row[3]}</div>
              <div class="timeline-prescription">Prescription: ${row[4]}</div>
            </div>
          `;
          timeline.appendChild(item);
        });
        document.getElementById("loadingSpinner").style.display = "none";
      });
  }

  // Add visit
  function addVisit() {
    if (!currentPatient) return alert("Search a patient first");

    let condition = document.getElementById("newCondition").value.trim();
    let prescription = document.getElementById("newPrescription").value.trim();
    if (!condition && !prescription) return alert("Enter condition or prescription");

    let data = {
      mobile: currentPatient.mobile,
      name: currentPatient.name,
      age: currentPatient.age,
      condition: condition,
      prescription: prescription,
    };

    document.getElementById("loadingSpinner").style.display = "block";
    fetch(API_URL, { method: "POST", body: JSON.stringify(data) })
      .then(res => res.text())
      .then(() => {
        alert("New Visit Added!");
        document.getElementById("newCondition").value = "";
        document.getElementById("newPrescription").value = "";
        searchPatient();
      });
  }
</script>

<!-- Your existing footer (unchanged) -->
<footer>
  <div class="footer-container">
    <!-- ... footer content unchanged ... -->
  </div>
</footer>
</body>
</html>
